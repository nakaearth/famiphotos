<source>
  type forward
  port 24224
  tag rails.log
</source>

<source>
  type tail
  path log/rails_application.log
  tag slack_rails_row
  format multiline
  format_firstline /^., /
  format1 /^., \[(?<time>[^\.]+).+\][ ]+(?<level>[^ ]+) -- :(?<message>.*)$/
  time_format %Y-%m-%dT%H:%M:%S
</source>

<source>
  type tail
  format ltsv
  path log/rails_application.log
  tag rails_application_log
  pas_file tmp/application_log.pos
</source>


<source>
  type mysql_slow_query
  path log/mysql_query.log
  tag mysql_slow_query_slack_notifier
</source>

<match rails_application_log>
  type forward

  <server>
    host 192.168.25.30
    port 24224
  </server>
</match>

# railsのエラーログを
<match slack_rails_row>
  type rewrite_tag_filter
  rewriterule1 level ERROR slack_info_and_error
  rewriterule2 level FATAL slack_info_and_error
  rewriterule3 level INFO  slack
  rewriterule4 level .+  clear
</match>

<match clear>
  type null
</match>

#<match mysql_slow_query**>
#  host 192.168.25.30
#  port 9200
#  index_name mysql_log
#  type_name mysqld
#  type elasticsearch
#</match>

<match slack>
  type slack
  webhook_url https://hooks.slack.com/services/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
  channel general
  username rails_dog
  flush_interval 5s
  icon_emoji :dog:
  message_keys level,message
  message "[%s] %s"
</match>

<match slack_info_and_error>
  type slack
  webhook_url https://hooks.slack.com/services/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
  channel general
  username rails_super_dog
  flush_interval 5s
  icon_emoji :ghost:
  color danger
  message_keys level,message
  message "[%s] %s"
</match>

<match mysql_slow_query_slack_notifier>
  type slack
  webhook_url https://hooks.slack.com/services/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
  channel general
  username mysql_slowlog_ghost
  icon_emoji :ghost:
  color danger
  message "Query_time:%s\r\nLock_time:%s\r\nRows_sent:%s\r\nRows_examined:%s"
  message_keys Query_time,Lock_time,Rows_sent,Rows_examined
  flush_interval 100m
</match>


<match rails.log>
  type file
  path /usr/local/project/famiphotos/log/rails_application_develop.log
</match>

