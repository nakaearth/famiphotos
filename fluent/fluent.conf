<source>
  type forward
  port 24224
  tag rails.log
</source>

# TODO mysqlのログをElasticsearchに入れる
<source>
  type mysql_slow_query
  path /usr/local/var/mysql/mysql/slow_log
  tag mysqld.slow_query
</source>

<match rails.*>
  host el2
  port 9200
  index_name famiphoto 
  type_name fluentd
  type elasticsearch
</match>

<match mysql_slow_query*>
  host localhost
  port 9200
  index_name mysql_log
  type_name fluentd
  type elasticsearch
</match>

<match slack>
  type slack
  slackbot_url https://hooks.slack.com/services/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
  channel general
  color danger
  message "start_time:%s\r\nuser_host:%s\r\nquery_time:%s\r\nlock_time:%s\r\nrows_sent:%s\r\nrows_examined:%s\r\ndb:%s\r\nlast_insert_id:%s\r\ninsert_id:%s\r\nserver_id:%s\r\nsql_text:%s"
  message_keys start_time,user_host,query_time,lock_time,rows_sent,rows_examined,db,last_insert_id,insert_id,server_id,sql_text
  flush_interval 60s
</match>

<match rails.log>
  type file
  path /usr/local/project/famiphotos/log/rails_application_develop.log
</match>

